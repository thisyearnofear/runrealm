# RunRealm GameFi UI Components

This document provides a comprehensive guide to the GameFi UI components added to RunRealm, which transform the running app into an immersive Web3 gaming experience.

## Overview

The GameFi UI system consists of several key components:

1. **GameFiUI** - Core service for managing the gaming HUD overlay
2. **TerritoryDashboard** - React component for territory management
3. **RunRealmIntegration** - Integration wrapper for the complete experience

## Components

### GameFiUI Service (`src/components/gamefi-ui.ts`)

The main service that provides the immersive gaming interface overlay.

#### Key Features

- **Player Stats HUD**: Shows level, distance, territories owned, and $REALM balance
- **Territory Preview Panel**: Interactive territory claiming interface
- **AI Coach**: Provides contextual guidance and route suggestions
- **Competition System**: Displays active territory battles
- **Reward Notifications**: Animated notifications for achievements
- **Map Legend**: Visual guide for territory status

#### Usage

```typescript
import { GameFiUI } from '../components/gamefi-ui';

// Initialize
const gamefiUI = GameFiUI.getInstance();
await gamefiUI.init();

// Enable GameFi mode
gamefiUI.enableGameFiMode();

// Update player stats
gamefiUI.updatePlayerStats({
  level: 5,
  totalDistance: 15000,
  territoriesOwned: 3,
  realmBalance: 250
});

// Show reward notification
gamefiUI.showRewardNotification('ðŸŽ‰ Territory claimed! +25 $REALM', 'success');

// Update AI coach message
gamefiUI.updateCoachMessage('Great run! You discovered a rare territory nearby.');
```

#### Events

The GameFiUI listens for and emits various events:

**Listening for:**
- `run:pointAdded` - Updates territory previews
- `web3:walletConnected` - Enables GameFi features
- `territory:claimed` - Shows claim notifications

**Emitting:**
- `territory:claimRequested` - User wants to claim territory
- `ai:routeRequested` - User requests AI route generation
- `ai:ghostRunnerRequested` - User spawns ghost runner

### TerritoryDashboard Component (`src/components/TerritoryDashboard.tsx`)

React component that provides comprehensive territory management and AI integration.

#### Props

```typescript
interface TerritoryDashboardProps {
  initialPosition?: { lat: number; lng: number };
  gameMode?: boolean;
  onTerritorySelect?: (territory: Territory) => void;
  onRouteGenerated?: (route: AIRouteProps) => void;
}
```

#### Features

- **Territory Management**: Claim, view, and manage territories
- **AI Route Generation**: Request optimal routes from AI
- **Ghost Runner Competition**: Spawn AI competitors
- **Real-time Updates**: Sync with blockchain and AI services
- **Mobile Responsive**: Optimized for all screen sizes

#### Usage

```tsx
import TerritoryDashboard from './components/TerritoryDashboard';

function App() {
  return (
    <TerritoryDashboard
      initialPosition={{ lat: 40.7128, lng: -74.0060 }}
      gameMode={true}
      onTerritorySelect={(territory) => console.log('Selected:', territory)}
      onRouteGenerated={(route) => console.log('Route:', route)}
    />
  );
}
```

### RunRealmIntegration Component (`src/components/RunRealmIntegration.tsx`)

Complete integration wrapper that shows how to combine all components.

#### Features

- **Map Initialization**: Sets up Mapbox map container
- **Service Integration**: Initializes all GameFi services
- **Wallet Connection**: Web3 wallet integration UI
- **Territory Modals**: Detailed territory information display

#### Usage

```tsx
import RunRealmIntegration from './components/RunRealmIntegration';

function App() {
  return (
    <RunRealmIntegration
      gameMode={true}
      showWalletButton={true}
      containerId="my-map-container"
    />
  );
}
```

## Architecture

### Event System

The GameFi components use a centralized event bus for communication:

```
RunRealmApp (Core) 
    â†• Events
GameFiUI (HUD) â†” TerritoryDashboard (Logic)
    â†• Events         â†• Events
AI Service     Web3 Service
```

### State Management

- **Player Stats**: Managed by TerritoryDashboard, displayed by GameFiUI
- **Territories**: Stored in TerritoryDashboard state, synced with blockchain
- **Ghost Runners**: Simulated AI competitors with progress tracking
- **Routes**: Generated by AI service, visualized on map

## Styling

### Theme

The GameFi UI uses a cyberpunk/gaming theme with:

- **Primary Colors**: Green (#00ff88, #00bd00) for positive actions
- **Secondary Colors**: Blue (#0064ff) for owned territories
- **Warning Colors**: Orange/Red (#ff6b00, #ff4444) for challenges
- **Background**: Dark gradients with transparency and blur effects

### Animations

- **Rotating Borders**: Player avatar and progress indicators
- **Slide Animations**: Panel entrances and notifications
- **Pulse Effects**: Stat updates and achievements
- **Shimmer Effects**: Button hover states

### Responsive Design

The UI adapts to different screen sizes:

- **Desktop**: Multi-panel layout with permanent HUD
- **Tablet**: Responsive panels with adjusted positioning
- **Mobile**: Overlay panels and simplified interface

## Integration Guide

### 1. Basic Integration

```typescript
// 1. Initialize the main app
const app = RunRealmApp.getInstance();
await app.initialize();

// 2. Enable GameFi mode
app.enableGameMode();

// 3. Connect wallet (optional)
await app.connectWallet();
```

### 2. React Integration

```tsx
// Wrap your app with the integration component
function App() {
  return (
    <div className="app">
      <RunRealmIntegration 
        gameMode={true}
        showWalletButton={true}
      />
    </div>
  );
}
```

### 3. Custom Integration

```typescript
// Initialize services individually
const gamefiUI = GameFiUI.getInstance();
const aiService = AIService.getInstance();
const web3Service = Web3Service.getInstance();

await Promise.all([
  gamefiUI.init(),
  aiService.init(),
  web3Service.init()
]);

// Set up custom event handlers
EventBus.getInstance().on('territory:claimRequested', async (data) => {
  // Custom territory claim logic
});
```

## Configuration

### Environment Variables

```env
# Required for Web3 functionality
REACT_APP_WEB3_PROVIDER_URL=https://sepolia.infura.io/v3/YOUR_KEY
REACT_APP_REALM_TOKEN_ADDRESS=0x...
REACT_APP_TERRITORY_NFT_ADDRESS=0x...

# Required for AI features
REACT_APP_OPENAI_API_KEY=sk-...

# Required for maps
REACT_APP_MAPBOX_ACCESS_TOKEN=pk.eyJ1...
```

### Feature Flags

```typescript
// In app-config.ts
const config = {
  features: {
    enableGameFi: true,
    enableWeb3: true,
    enableAI: true,
    enableGhostRunners: true,
    enableTerritoryBattles: false // Coming soon
  }
};
```

## API Reference

### GameFiUI Methods

- `init()` - Initialize the GameFi UI system
- `enableGameFiMode()` - Activate gaming interface
- `updatePlayerStats(stats)` - Update player statistics
- `showTerritoryPreview(data)` - Display territory preview
- `showRewardNotification(message, type)` - Show reward popup
- `updateCoachMessage(message)` - Update AI coach text
- `cleanup()` - Clean up resources

### TerritoryDashboard Methods

- Component automatically manages its state through React hooks
- Communicates through props: `onTerritorySelect`, `onRouteGenerated`
- Integrates with services through event bus

## Best Practices

### Performance

- Use `gamefiUI.cleanup()` when unmounting components
- Batch stat updates to avoid excessive re-renders
- Implement virtual scrolling for large territory lists

### UX Guidelines

- Always provide feedback for user actions
- Use loading states for async operations
- Implement progressive disclosure for complex features
- Maintain consistent visual hierarchy

### Accessibility

- Include ARIA labels for interactive elements
- Support keyboard navigation
- Provide high contrast mode option
- Include screen reader announcements for key events

## Troubleshooting

### Common Issues

**GameFi UI not visible:**
```typescript
// Ensure GameFi mode is enabled
document.body.classList.add('gamefi-mode');
```

**Events not working:**
```typescript
// Check event bus initialization
const eventBus = EventBus.getInstance();
console.log('Event bus listeners:', eventBus.listenerCount('territory:claimed'));
```

**Web3 integration failing:**
```typescript
// Check wallet connection
const web3 = Web3Service.getInstance();
const connected = await web3.isConnected();
console.log('Wallet connected:', connected);
```

### Debug Mode

Enable debug logging:

```typescript
// Add to localStorage for persistent debugging
localStorage.setItem('runrealm_debug', 'true');

// Or set environment variable
process.env.REACT_APP_DEBUG = 'true';
```

## Future Enhancements

- **Territory Battles**: PvP territory claiming system
- **Leaderboards**: Global and local ranking systems  
- **NFT Rewards**: Unique collectibles for achievements
- **Social Features**: Teams, guilds, and collaborative challenges
- **AR Integration**: Augmented reality territory visualization
- **Advanced AI**: Machine learning for personalized experiences

## Contributing

When contributing to GameFi components:

1. Follow the existing event-driven architecture
2. Maintain consistent styling and theming
3. Add comprehensive tests for new features
4. Update documentation for API changes
5. Consider mobile experience in all designs

---

For more information, see the main RunRealm documentation or contact the development team.
